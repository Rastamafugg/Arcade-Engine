import { paletteRGBA } from './config.js';

// ================================================================
// 5Ã—7 glyphs as 5-bit row masks. CHAR_W=6, CHAR_H=8 (includes gap).
// ================================================================
export const FONT_SRC = {
  ' ':['00000','00000','00000','00000','00000','00000','00000'],
  'A':['01110','10001','10001','11111','10001','10001','00000'],
  'B':['11110','10001','11110','10001','10001','11110','00000'],
  'C':['01110','10001','10000','10000','10001','01110','00000'],
  'D':['11100','10010','10001','10001','10010','11100','00000'],
  'E':['11111','10000','11110','10000','10000','11111','00000'],
  'F':['11111','10000','11110','10000','10000','10000','00000'],
  'G':['01110','10001','10000','10111','10001','01110','00000'],
  'H':['10001','10001','11111','10001','10001','10001','00000'],
  'I':['01110','00100','00100','00100','00100','01110','00000'],
  'J':['00111','00010','00010','00010','10010','01100','00000'],
  'K':['10001','10010','11100','10010','10001','10001','00000'],
  'L':['10000','10000','10000','10000','10000','11111','00000'],
  'M':['10001','11011','10101','10001','10001','10001','00000'],
  'N':['10001','11001','10101','10011','10001','10001','00000'],
  'O':['01110','10001','10001','10001','10001','01110','00000'],
  'P':['11110','10001','11110','10000','10000','10000','00000'],
  'Q':['01110','10001','10001','10101','10011','01111','00000'],
  'R':['11110','10001','11110','10100','10010','10001','00000'],
  'S':['01111','10000','01110','00001','00001','11110','00000'],
  'T':['11111','00100','00100','00100','00100','00100','00000'],
  'U':['10001','10001','10001','10001','10001','01110','00000'],
  'V':['10001','10001','10001','10001','01010','00100','00000'],
  'W':['10001','10001','10001','10101','11011','10001','00000'],
  'X':['10001','01010','00100','00100','01010','10001','00000'],
  'Y':['10001','10001','01010','00100','00100','00100','00000'],
  'Z':['11111','00001','00010','00100','01000','11111','00000'],
  '0':['01110','10001','10011','10101','11001','01110','00000'],
  '1':['00100','01100','00100','00100','00100','01110','00000'],
  '2':['01110','10001','00010','00100','01000','11111','00000'],
  '3':['11110','00001','00110','00001','00001','11110','00000'],
  '4':['00010','00110','01010','10010','11111','00010','00000'],
  '5':['11111','10000','11110','00001','00001','11110','00000'],
  '6':['00110','01000','11110','10001','10001','01110','00000'],
  '7':['11111','00001','00010','00100','01000','01000','00000'],
  '8':['01110','10001','01110','10001','10001','01110','00000'],
  '9':['01110','10001','10001','01111','00001','01110','00000'],
  '!':['00100','00100','00100','00100','00000','00100','00000'],
  '?':['01110','10001','00010','00100','00000','00100','00000'],
  '.':['00000','00000','00000','00000','00000','00100','00000'],
  ',':['00000','00000','00000','00000','00100','00100','01000'],
  ':':['00000','00100','00000','00000','00100','00000','00000'],
  ';':['00000','00100','00000','00000','00100','00100','01000'],
  '-':['00000','00000','11111','00000','00000','00000','00000'],
  '\'':['01100','01100','00000','00000','00000','00000','00000'],
  '"':['01010','01010','00000','00000','00000','00000','00000'],
  '(':['00010','00100','01000','01000','00100','00010','00000'],
  ')':['01000','00100','00010','00010','00100','01000','00000'],
  '/':['00001','00010','00100','01000','10000','00000','00000'],
  '#':['01010','11111','01010','01010','11111','01010','00000'],
  '*':['00000','10101','01110','11111','01110','10101','00000'],
  '>':['10000','01000','00100','00100','01000','10000','00000'],
  '<':['00001','00010','00100','00100','00010','00001','00000'],
  '+':['00000','00100','00100','11111','00100','00100','00000'],
  '_':['00000','00000','00000','00000','00000','11111','00000'],
};

export const FONT = {};
for (const [ch, rows] of Object.entries(FONT_SRC)) {
  FONT[ch] = rows.map(r => parseInt(r, 2));
}

export const CHAR_W = 6;
export const CHAR_H = 8;

export function buildPaletteSwap(spriteData, indexMap) {
  return _rasterizeBuf(i => {
    const raw = spriteData[i];
    if (raw === null) return null;
    return (indexMap[raw] !== undefined) ? indexMap[raw] : raw;
  });
}
